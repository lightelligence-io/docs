# Public User App 0510

1. Verify role: John	Doe	christoph.albrecht@posteo.de OWNER

2. Register app:
{
        "name": "Public User App 0510",
        "withPublicOauth2Client": true,
        "allowedTenants": [
            {
                "tenantId": "b1747579-355d-4b7a-aa72-c2336d3a7211",
                "comment": "Example Inc., northern plant"
            }
        ],
        "redirectUris": [
            "https://oauthdebugger.com/debug",
            "https://prod.application.com/auth/callback"
        ]
    }
	
Response:

{
    "data": {
        "id": "cd8f0ad6-290a-4fea-b3ba-8df5e9ae88e9",
        "name": "Public User App 0510",
        "withPublicOauth2Client": true,
        "oauth2Client": {
            "id": "d49014f7-4f2f-420c-ae2c-166a5709ee83",
            "secret": "YTaaCasWELOb6fqH",
            "type": "confidental"
        },
        "publicOauth2Client": {
            "id": "bb6ed503-ad2e-42f3-b5d3-45f338ecea02",
            "type": "public"
        },
        "tenantId": "b1747579-355d-4b7a-aa72-c2336d3a7211",
        "status": "active",
        "createdAt": "2019-05-10T09:00:31.376Z",
        "updatedAt": "2019-05-10T09:00:31.376Z",
        "redirectUris": [
            "https://oauthdebugger.com/debug",
            "https://prod.application.com/auth/callback"
        ],
        "allowedTenants": [
            {
                "tenantId": "b1747579-355d-4b7a-aa72-c2336d3a7211",
                "createdAt": "2019-05-10T09:00:31.392Z",
                "installed": false,
                "comment": "Example Inc., northern plant"
            }
        ]
    }
}


3. install the application, with a PUT request to the /applications/{applicationId}/installation endpoint.

https://api.dev.olt-dev.io/v1/applications/cd8f0ad6-290a-4fea-b3ba-8df5e9ae88e9/installation

Response:
{
    "data": {
        "tenantId": "b1747579-355d-4b7a-aa72-c2336d3a7211",
        "createdAt": "2019-05-10T09:07:16.801Z"
    }
}


4. verify the app is installed: 

https://api.dev.olt-dev.io/v1/applications

Response:
{
            "id": "cd8f0ad6-290a-4fea-b3ba-8df5e9ae88e9",
            "name": "Public User App 0510",
            "available": true,
            "availableCode": "APP_AVAILABLE",
            "installation": {
                "tenantId": "b1747579-355d-4b7a-aa72-c2336d3a7211",
                "createdAt": "2019-05-10T09:07:16.801Z"
            }




5. get the Oauth2 authorization code, [{"key":"Content-Type","name":"Content-Type","value":"application/x-www-form-urlencoded","description":"","type":"text"}]

https://id.dev.olt-dev.io/v1/id/auth/realms/olt/protocol/openid-connect/auth
?client_id=d49014f7-4f2f-420c-ae2c-166a5709ee83
&redirect_uri=https://oauthdebugger.com/debug
&scope=openid
&response_type=code
&response_mode=form_post

a) Enter the following request in the browser address field: 
https://id.dev.olt-dev.io/v1/id/auth/realms/olt/protocol/openid-connect/auth?client_id=d49014f7-4f2f-420c-ae2c-166a5709ee83&redirect_uri=https://oauthdebugger.com/debug&scope=openid&response_type=code&response_mode=form_post

Result: 

"Hello John, you are using the application Public User App 0510"

On selecting the tenant, I get the auth code:
		
eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..V5SWNAKS_NY6yV9ZQTpcRw.yc0j0veovN2XKMp4dUMvErDC43tKH1J1mvJdMZW53v6_t3LCyJhaRSVXZhPI-SwO8HgR017oSNb7f91Uim1qbtXuJ3yrOrBzbKrENW0J78jnkOB1BrxumClQnsgF7DXnIEeYd_7wy7ZwYxz9v6UHgOmc-iDrEaRQ_txiSLYr66ahMNjQqznVd-e1gvHtfp9t7EbzaF_lsx0sJHNbnnVpUbL0hvpNW_NHv_xjKiR8WTsidXpmVKv3OoYzOF4vLjgn.VUlxPwMiMFyXSt57vtudaQ

6. Get access token

Put request in browser address field:

https://id.dev.olt-dev.io/v1/id/auth/realms/olt/protocol/openid-connect/token?grant_type=authorization_code&code=eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..V5SWNAKS_NY6yV9ZQTpcRw.yc0j0veovN2XKMp4dUMvErDC43tKH1J1mvJdMZW53v6_t3LCyJhaRSVXZhPI-SwO8HgR017oSNb7f91Uim1qbtXuJ3yrOrBzbKrENW0J78jnkOB1BrxumClQnsgF7DXnIEeYd_7wy7ZwYxz9v6UHgOmc-iDrEaRQ_txiSLYr66ahMNjQqznVd-e1gvHtfp9t7EbzaF_lsx0sJHNbnnVpUbL0hvpNW_NHv_xjKiR8WTsidXpmVKv3OoYzOF4vLjgn.VUlxPwMiMFyXSt57vtudaQ
&client_id=d49014f7-4f2f-420c-ae2c-166a5709ee83&redirect_uri=https://oauthdebugger.com/debug
		
Result:

"Lightelligence 

An internal server error has occurred	"	

The same query posted in Postman renders

{
    "error": "invalid_request",
    "error_description": "Missing form parameter: grant_type"
}

Note: 
* grant type is defined in the query params as "authorization_code"
* content type is defined in the Header as "/x-www-form-urlencoded"
* I have tried fifferent browsers


So step 5. in your description "The user takes this token and does a normal API call to `id.lightelligence.io.../token` with the code (as you defined in your example)." doesn't work for me.
